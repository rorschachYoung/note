# Mysql
## 1.linux下安装


## 2.Mysql
首先确保安装了mysql并且把mysql放入了环境变量中  
> mysql -h 127.0.0.1 -p 3306 -u root -p  
> mysql -u root -p
然后输入密码进入mysql 操作界面  

### 2.0 编码
数据库的编码
字符接,编码  utf8mb4  支持更多的unicode字符(4字节)
数据校对排序  utf8mb4_unicode_ci  基于标准的unicode来进行排序和比较,在各种语言之间精确排序
字符集编码  _bin,_cs  区分大小写
           _ci:不区大小写

### 2.1 查看数据库跟表
1.show databases  显示数据库
2. use test       使用test数据库
3. show tables 
4. 建表
index suoyin(id) 表示根据id建立索引
建立comment评论表  
create table  comment(
    id int unsigned primary key auto_increment comment 'unsigned表示无符号(此处即无-号)',
    name char(20),
    pubtime datetime,
    content varchar(200),
    index suoyin(id) 
)engine=innodb default charset=utf8mb4 collate=utf8mb4_unicode_ci;
建立user用户表  
create table user(
    id int primary key auto_increment not null,
    nickname varchar(50) not null,
    password varchar(50) not null,
    birthday date,
    gender int,
    telephone varchar(50) not null,
    city int,
    score int default 0 not null comment '积分', 
    balance decimal(18,4) default 0 not null comment '余额',
    regtime datetime not null comment '注册时间',
    motto varchar(50) comment '个性签名'
)charset utf8   
建立address用户收货地址表
create table address(
    id int primary key auto_increment not null,
    address varchar(200) not null,
    userid int not null comment '外键',
    name varchar(50) comment '收件人' not null,
    telephone varchar(50) comment '联系电话' not null
)charset utf8 
5. desc comment    查看表字段 desc tableName 查看表的信息
5. select * from comment  

### 2.2 Mysql CRUD
mysql表数据的增删改查
#### 2.2.1 insert
1. 首先进入数据库，show databases,然后desc [user] 查看user表结构(表列字段)  
2. insert into user (uid,name,age) values (1,'zs',23)  
3. select * from user 查看表数据  
4. insert into user (name,age) values ('ls',19)因为uid自增长，可以不写    
5. insert into user values (5 ,'xx',22) 可以    
6. insert into user values ('ss', 22)  不可以，即使uid自增，k-v也要对应上    
7. insert into user values (5 ,'xx',22),(6,'ss',11) 插入多条    
#### 2.2.2 update 
1. update user set name='sb' where uid=8  修改uid=8的name字段值为'sb'  
2. update user set  name='sb',age=29 where uid=8 修改多个字段值  
3. update user set name = 'sb' 没有where限制语句，就会把整张表全部name字段值改为'sb'  
#### 2.2.3 delete 
1. delete from user where uid =1  
#### 2.2.4 select 
1.  select * from user where uid = 1  
2.  select uid,age,name from user   
3.  select uid,age,name from user where uid <= 5  
4.  select uid,age,name from user where uid <= 5  
5.  select uid,age,name from user where uid like "%1%"  %表示匹配任意个字符  


### 2.3 限制语句(条件查询)
#### 2.3.1 where
where可用的运算符  + - * / % > >= <= = += !=   and  or not

between 13 and 16

in (1,3,5) 符合其中一个 

like "%1_"  %代表任意个任意字符  _代表一个任意字符

select * from student where age regexp '1|3'

group by 分组
select age from student group by age 
显示所有出现的年龄信息
select age,count(*) as count from student group by age 
显示所有出现的年龄信息,并统计改年龄有多少数量
除了count函数还有avg() max() min() sum()


having 是删选group by之后的数据

order by  age      默认正序
order by  age asc  正序排列
order by  age desc 倒序排列

limit 10 offset 10  从第二页第11条查询1o条出来
limit startnum,count  startnum 起始数据 count 数据条
limit 3,10  从4开始查询10条

#### 2.4 多表联合查询
select * from tablea as a join tableb as b on a.name = b.name

#### 2.5 左右连接
左链接查询表示以左表为主,连接上右表跟左表相同值得部分,如右表没有左表的值怎补齐null
select * from tablea as a join tableb as b on a.name = b.name
多表查询后会有相同的字段,可以通过左,右连接左右 来选用表的字段
或者从夺标查询的结果直接选取左右表的字段这样 也是一种方法
select a.name,a.age from tablea as a join tableb as b on a.name = b.name


(let a = n => n===1 ? 1 : a(n-1) + n )(8)

### 3.索引失效
建立索引
在 test 表上根据 id 建立 index_id 索引   
> cretea index index_id on test(id)  

在 test 表上根据 name,age 建立 name_age 联合索引   
> cretea index name_age on test(name,age)  
在 test 表上根据 id 建立 index_id 虚拟索引   
> create index idx_id on test(id) nosegment  

0.进行全值匹配
1.模糊查询用%开头(如果索引空不会失效)
2.条件查询,使用<> or in +-*/ is not null
3.联合索引,从左前缀开始依次传值索引
4.查询字段的类型错误


## Node连接mysql
安装mysql模块
> npm i mysql 
```js

const mysql = require('mysql')
const xss = require('xss')
let conn = mysql.createConnection({
    host:'localhost',
    user:'root',
    password:'12345',
    database:'test',
})
conn.connect((err,result)=>{
    let username = mysql.escape(username) /* 通过mysql提供的escape来对sql注入进行防范 */
    let title = xss(title) /* 防止xss跨域脚本攻击,对要插入数据库的内容进行转义 */
    conn.query(`select * from user where uername = ${username}`,(err,data)=>{
        console.log(err,data)
    })
})


```
```JS
const mysql = require('mysql2')
let conn = mysql.createConnection({
    host:'localhost',
    user:'root',
    password:'12345',
    database:'test',
})
conn.connect((err,result)=>{
    conn.query('select * from user',(err,data)=>{
        console.log(err,data)
    })
})
``` 

```js
const mysql = require('mysql2/promise'); /*mysql2/promise.js*/
// const mysql = require('mysql2')   /*mysql2/index.js*/
(async function(){
    const connect =  await mysql.createConnection({
        host:'127.0.0.1',
        user:'root',
        password:'12345',
        database:'test',
    })
    let data = await connect.query('select * from user')
    console.log(data[0])
})();

```
